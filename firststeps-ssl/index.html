
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://mailcow.github.io/mailcow-dockerized-docs/firststeps-ssl/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Advanced SSL - mailcow: dockerized documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lets-encrypt-out-of-the-box" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="mailcow: dockerized documentation" class="md-header__button md-logo" aria-label="mailcow: dockerized documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mailcow: dockerized documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced SSL
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/mailcow/mailcow-dockerized/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mailcow/mailcow-dockerized
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="mailcow: dockerized documentation" class="md-nav__button md-logo" aria-label="mailcow: dockerized documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    mailcow: dockerized documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/mailcow/mailcow-dockerized/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mailcow/mailcow-dockerized
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Information & Support
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Prerequisites
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Prerequisites" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Prerequisites
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../prerequisite-system/" class="md-nav__link">
        Prepare your system
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../prerequisite-dns/" class="md-nav__link">
        DNS setup
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Installation, Update & Migration
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Installation, Update & Migration" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Installation, Update & Migration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../i_u_m_install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../i_u_m_update/" class="md-nav__link">
        Update
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../i_u_m_migration/" class="md-nav__link">
        Migration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../i_u_m_deinstall/" class="md-nav__link">
        Deinstallation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Post Installation Tasks
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Post Installation Tasks" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Post Installation Tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Advanced SSL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Advanced SSL
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lets-encrypt-out-of-the-box" class="md-nav__link">
    Let's Encrypt (out-of-the-box)
  </a>
  
    <nav class="md-nav" aria-label="Let's Encrypt (out-of-the-box)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#additional-domain-names" class="md-nav__link">
    Additional domain names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-renewal" class="md-nav__link">
    Force renewal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-errors-and-how-to-skip-validation" class="md-nav__link">
    Validation errors and how to skip validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-lets-encrypt" class="md-nav__link">
    Disable Let's Encrypt
  </a>
  
    <nav class="md-nav" aria-label="Disable Let's Encrypt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disable-lets-encrypt-completely" class="md-nav__link">
    Disable Let's Encrypt completely
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skip-all-names-but-mailcow_hostname" class="md-nav__link">
    Skip all names but ${MAILCOW_HOSTNAME}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-lets-encrypt-subjectaltname-limit-of-100-domains" class="md-nav__link">
    The Let's Encrypt subjectAltName limit of 100 domains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-your-own-certificate" class="md-nav__link">
    How to use your own certificate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-against-staging-acme-directory" class="md-nav__link">
    Test against staging ACME directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-directory-url" class="md-nav__link">
    Custom directory URL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-your-configuration" class="md-nav__link">
    Check your configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-disable_ipv6/" class="md-nav__link">
        Disable IPv6
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-ip_bindings/" class="md-nav__link">
        IP bindings
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-local_mta/" class="md-nav__link">
        Local MTA on Docker host
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-relayhost/" class="md-nav__link">
        Relayhosts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-rp/" class="md-nav__link">
        Reverse Proxy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-rspamd_ui/" class="md-nav__link">
        Rspamd UI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-snat/" class="md-nav__link">
        SNAT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-sync_jobs_migration/" class="md-nav__link">
        Sync job migration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../firststeps-trust_networks/" class="md-nav__link">
        Add trusted networks
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Models
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Models" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../model-acl/" class="md-nav__link">
        ACL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../model-passwd/" class="md-nav__link">
        Password hashing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../model-sender_rcv/" class="md-nav__link">
        Sender and receiver model
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        General Troubleshooting
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="General Troubleshooting" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          General Troubleshooting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-attach_service/" class="md-nav__link">
        Attach a Container
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-reset_pw/" class="md-nav__link">
        Reset Passwords (incl. SQL)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-mysql_upgrade/" class="md-nav__link">
        Manual MySQL upgrade
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-rm_volumes/" class="md-nav__link">
        Remove Persistent Data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-common_problems/" class="md-nav__link">
        Common Problems
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-admin_login_sogo/" class="md-nav__link">
        Admin login to SOGo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../debug-reset-tls/" class="md-nav__link">
        Reset TLS certificates
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Backup & Restore
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Backup & Restore" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Backup & Restore
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      <label class="md-nav__link" for="__nav_7_1">
        Helper script
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Helper script" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Helper script
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../b_n_r_backup/" class="md-nav__link">
        Backup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../b_n_r_restore/" class="md-nav__link">
        Restore
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      <label class="md-nav__link" for="__nav_7_2">
        Manually
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Manually" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Manually
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-backup_restore-maildir/" class="md-nav__link">
        Maildir
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-backup_restore-mysql/" class="md-nav__link">
        MySQL
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Manual/Guides/Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Manual/Guides/Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Manual/Guides/Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1" type="checkbox" id="__nav_8_1" >
      
      <label class="md-nav__link" for="__nav_8_1">
        mailcow UI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="mailcow UI" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          mailcow UI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-config/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-bl_wl/" class="md-nav__link">
        Blacklist / Whitelist
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-pushover/" class="md-nav__link">
        Pushover
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-spamfilter/" class="md-nav__link">
        Spamfilter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-spamalias/" class="md-nav__link">
        Temporary email aliases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-tagging/" class="md-nav__link">
        Tagging
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-mailcow_ui-tfa/" class="md-nav__link">
        Two-Factor Authentication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-fido2/" class="md-nav__link">
        WebAuthn / FIDO2
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2" type="checkbox" id="__nav_8_2" >
      
      <label class="md-nav__link" for="__nav_8_2">
        Postfix
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Postfix" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          Postfix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-postfix-custom_transport/" class="md-nav__link">
        Custom transport maps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-postfix-postscreen_whitelist/" class="md-nav__link">
        Whitelist IP in Postscreen
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-postfix-extra_cf/" class="md-nav__link">
        Customize/Expand main.cf
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-postfix-disable_sender_verification/" class="md-nav__link">
        Disable Sender Addresses Verification
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-postfix-attachment_size/" class="md-nav__link">
        Max. message size (attachment size)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-postfix-pflogsumm/" class="md-nav__link">
        Statistics with pflogsumm
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_3" type="checkbox" id="__nav_8_3" >
      
      <label class="md-nav__link" for="__nav_8_3">
        Unbound
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Unbound" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_3">
          <span class="md-nav__icon md-icon"></span>
          Unbound
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-unbound-fwd/" class="md-nav__link">
        Using an external DNS service
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_4" type="checkbox" id="__nav_8_4" >
      
      <label class="md-nav__link" for="__nav_8_4">
        Dovecot
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Dovecot" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_4">
          <span class="md-nav__icon md-icon"></span>
          Dovecot
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-any_acl/" class="md-nav__link">
        Enable "any" ACL settings
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-expunge/" class="md-nav__link">
        Expunge a Users mails
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-extra_conf/" class="md-nav__link">
        Customize/Expand dovecot.conf
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-fts/" class="md-nav__link">
        FTS (Solr)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-idle_interval/" class="md-nav__link">
        IMAP IDLE interval
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-mail-crypt/" class="md-nav__link">
        Mail crypt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-more/" class="md-nav__link">
        More Examples with DOVEADM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-vmail-volume/" class="md-nav__link">
        Move Maildir (vmail)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-public_folder/" class="md-nav__link">
        Public folders
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-dovecot-static_master/" class="md-nav__link">
        Static master user
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5" type="checkbox" id="__nav_8_5" >
      
      <label class="md-nav__link" for="__nav_8_5">
        Nginx
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Nginx" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_5">
          <span class="md-nav__icon md-icon"></span>
          Nginx
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-nginx/" class="md-nav__link">
        Custom sites
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-webmail-site/" class="md-nav__link">
        Create subdomain webmail.example.org
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-redis/" class="md-nav__link">
        Redis
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-rspamd/" class="md-nav__link">
        Rspamd
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-sogo/" class="md-nav__link">
        SOGo
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_9" type="checkbox" id="__nav_8_9" >
      
      <label class="md-nav__link" for="__nav_8_9">
        XMPP
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="XMPP" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_9">
          <span class="md-nav__icon md-icon"></span>
          XMPP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-xmpp-faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-xmpp-enable/" class="md-nav__link">
        Enable XMPP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_10" type="checkbox" id="__nav_8_10" >
      
      <label class="md-nav__link" for="__nav_8_10">
        Docker
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Docker" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_10">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-docker-cust_dockerfiles/" class="md-nav__link">
        Customize Dockerfiles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-docker-dc_bash_compl/" class="md-nav__link">
        Docker Compose Bash Completion
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-why_unbound/" class="md-nav__link">
        Why unbound?
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-autodiscover_config/" class="md-nav__link">
        Autodiscover / Autoconfig
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-80_to_443/" class="md-nav__link">
        Redirect HTTP to HTTPS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../u_e-reeanble-weak-protocols/" class="md-nav__link">
        Re-enable TLS 1.0 and TLS 1.1
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Client Configuration
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Client Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Client Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-android/" class="md-nav__link">
        Android
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-apple/" class="md-nav__link">
        Apple macOS / iOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-emclient/" class="md-nav__link">
        eM Client
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-gajim_xmpp_client/" class="md-nav__link">
        Gajim XMPP client
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-kontact/" class="md-nav__link">
        KDE Kontact
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-outlook/" class="md-nav__link">
        Microsoft Outlook
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-thunderbird/" class="md-nav__link">
        Mozilla Thunderbird
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-windows/" class="md-nav__link">
        Windows Mail
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-windowsphone/" class="md-nav__link">
        Windows Phone
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../client/client-manual/" class="md-nav__link">
        Manual configuration
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        Third party apps
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Third party apps" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Third party apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-borgmatic/" class="md-nav__link">
        Borgmatic Backup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-exchange_onprem/" class="md-nav__link">
        Exchange Hybrid Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-gitea/" class="md-nav__link">
        Gitea
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-gogs/" class="md-nav__link">
        Gogs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-mailpiler_integration/" class="md-nav__link">
        Mailpiler Integration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-nextcloud/" class="md-nav__link">
        Nextcloud
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-portainer/" class="md-nav__link">
        Portainer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-roundcube/" class="md-nav__link">
        Roundcube
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../third_party-thunderbird/" class="md-nav__link">
        SOGo Connector for Thunderbird
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lets-encrypt-out-of-the-box" class="md-nav__link">
    Let's Encrypt (out-of-the-box)
  </a>
  
    <nav class="md-nav" aria-label="Let's Encrypt (out-of-the-box)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#additional-domain-names" class="md-nav__link">
    Additional domain names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-renewal" class="md-nav__link">
    Force renewal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-errors-and-how-to-skip-validation" class="md-nav__link">
    Validation errors and how to skip validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-lets-encrypt" class="md-nav__link">
    Disable Let's Encrypt
  </a>
  
    <nav class="md-nav" aria-label="Disable Let's Encrypt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disable-lets-encrypt-completely" class="md-nav__link">
    Disable Let's Encrypt completely
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skip-all-names-but-mailcow_hostname" class="md-nav__link">
    Skip all names but ${MAILCOW_HOSTNAME}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-lets-encrypt-subjectaltname-limit-of-100-domains" class="md-nav__link">
    The Let's Encrypt subjectAltName limit of 100 domains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-your-own-certificate" class="md-nav__link">
    How to use your own certificate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-against-staging-acme-directory" class="md-nav__link">
    Test against staging ACME directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-directory-url" class="md-nav__link">
    Custom directory URL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-your-configuration" class="md-nav__link">
    Check your configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/mailcow/mailcow-dockerized-docs/edit/master/docs/firststeps-ssl.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Advanced SSL</h1>
                
                <h2 id="lets-encrypt-out-of-the-box">Let's Encrypt (out-of-the-box)<a class="headerlink" href="#lets-encrypt-out-of-the-box" title="Permanent link">&para;</a></h2>
<p>The "acme-mailcow" container will try to obtain a LE certificate for <code>${MAILCOW_HOSTNAME}</code>, <code>autodiscover.ADDED_MAIL_DOMAIN</code> and <code>autoconfig.ADDED_MAIL_DOMAIN</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>mailcow <strong>must</strong> be available on port 80 for the acme-client to work. Our reverse proxy example configurations do cover that. You can also use any external ACME client (certbot for example) to obtain certificates, but you will need to make sure, that they are copied to the correct location and a post-hook reloads affected containers. See more in the Reverse Proxy documentation.</p>
</div>
<p>By default, which means <strong>0 domains</strong> are added to mailcow, it will try to obtain a certificate for <code>${MAILCOW_HOSTNAME}</code>.</p>
<p>For each domain you add, it will try to resolve <code>autodiscover.ADDED_MAIL_DOMAIN</code> and <code>autoconfig.ADDED_MAIL_DOMAIN</code> to its IPv6 address or - if IPv6 is not configured in your domain - IPv4 address. If it succeeds, a name will be added as SAN to the certificate request.</p>
<p>Only names that can be validated, will be added as SAN.</p>
<p>For every domain you remove, the certificate will be moved and a new certificate will be requested. It is not possible to keep domains in a certificate, when we are not able validate the challenge for those.</p>
<p>If you want to re-run the ACME client, use <code>docker-compose restart acme-mailcow</code> and monitor its logs with <code>docker-compose logs --tail=200 -f acme-mailcow</code>.</p>
<h3 id="additional-domain-names">Additional domain names<a class="headerlink" href="#additional-domain-names" title="Permanent link">&para;</a></h3>
<p>Edit "mailcow.conf" and add a parameter <code>ADDITIONAL_SAN</code> like this:</p>
<p>Do not use quotes (<code>"</code>) and do not use spaces between the names!</p>
<div class="highlight"><pre><span></span><code>ADDITIONAL_SAN=smtp.*,cert1.example.com,cert2.example.org,whatever.*
</code></pre></div>
<p>Each name will be validated against its IPv6 address or - if IPv6 is not configured in your domain - IPv4 address.</p>
<p>A wildcard name like <code>smtp.*</code> will try to obtain a smtp.DOMAIN_NAME SAN for each domain added to mailcow.</p>
<p>Run <code>docker-compose up -d</code> to recreate affected containers automatically.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Using names other name <code>MAILCOW_HOSTNAME</code> to access the mailcow UI may need further configuration.</p>
</div>
<p>If you plan to use a server name that is not <code>MAILCOW_HOSTNAME</code> to access the mailcow UI (for example by adding <code>mail.*</code> to <code>ADDITIONAL_SAN</code> make sure to populate that name in mailcow.conf via <code>ADDITIONAL_SERVER_NAMES</code>. Names must be separated by commas and <strong>must not</strong> contain spaces. If you skip this step, mailcow may respond with an incorrect site.</p>
<div class="highlight"><pre><span></span><code>ADDITIONAL_SERVER_NAMES=webmail.domain.tld,other.example.tld
</code></pre></div>
<p>Run <code>docker-compose up -d</code> to apply.</p>
<h3 id="force-renewal">Force renewal<a class="headerlink" href="#force-renewal" title="Permanent link">&para;</a></h3>
<p>To force a renewal, you need to create a file named <code>force_renew</code> and restart the <code>acme-mailcow</code> container:</p>
<div class="highlight"><pre><span></span><code>cd /opt/mailcow-dockerized
touch data/assets/ssl/force_renew
docker-compose restart acme-mailcow
# Now check the logs for a renewal
docker-compose logs --tail=200 -f acme-mailcow
</code></pre></div>
<p>The file will be deleted automatically.</p>
<h3 id="validation-errors-and-how-to-skip-validation">Validation errors and how to skip validation<a class="headerlink" href="#validation-errors-and-how-to-skip-validation" title="Permanent link">&para;</a></h3>
<p>You can skip the <strong>IP verification</strong> by setting <code>SKIP_IP_CHECK=y</code> in mailcow.conf (no quotes). Be warned that a misconfiguration will get you ratelimited by Let's Encrypt! This is primarily useful for multi-IP setups where the IP check would return the incorrect source IP address. Due to using dynamic IPs for acme-mailcow, source NAT is not consistent over restarts.</p>
<p>If you encounter problems with "HTTP validation", but your IP address confirmation succeeds, you are most likely using firewalld, ufw or any other firewall, that disallows connections from <code>br-mailcow</code> to your external interface. Both firewalld and ufw disallow this by default. It is often not enough to just stop these firewall services. You'd need to stop mailcow (<code>docker-compose down</code>), stop the firewall service, flush the chains and restart Docker.</p>
<p>You can also skip this validation method by setting <code>SKIP_HTTP_VERIFICATION=y</code> in "mailcow.conf". Be warned that this is discouraged. In most cases, the HTTP verification is skipped to workaround unknown NAT reflection issues, which are not resolved by ignoring this specific network misconfiguration. If you encounter problems generating TLSA records in the DNS overview within mailcow, you are most likely having issues with NAT reflection you should fix.</p>
<p>If you changed a SKIP_* parameter, run <code>docker-compose up -d</code> to apply your changes.</p>
<h3 id="disable-lets-encrypt">Disable Let's Encrypt<a class="headerlink" href="#disable-lets-encrypt" title="Permanent link">&para;</a></h3>
<h4 id="disable-lets-encrypt-completely">Disable Let's Encrypt completely<a class="headerlink" href="#disable-lets-encrypt-completely" title="Permanent link">&para;</a></h4>
<p>Set <code>SKIP_LETS_ENCRYPT=y</code> in "mailcow.conf" and recreate "acme-mailcow" by running <code>docker-compose up -d</code>.</p>
<h4 id="skip-all-names-but-mailcow_hostname">Skip all names but ${MAILCOW_HOSTNAME}<a class="headerlink" href="#skip-all-names-but-mailcow_hostname" title="Permanent link">&para;</a></h4>
<p>Add <code>ONLY_MAILCOW_HOSTNAME=y</code> to "mailcow.conf" and recreate "acme-mailcow" by running <code>docker-compose up -d</code>.</p>
<h3 id="the-lets-encrypt-subjectaltname-limit-of-100-domains">The Let's Encrypt subjectAltName limit of 100 domains<a class="headerlink" href="#the-lets-encrypt-subjectaltname-limit-of-100-domains" title="Permanent link">&para;</a></h3>
<p>Let's Encrypt currently has <a href="https://letsencrypt.org/docs/rate-limits/">a limit of 100 Domain Names per Certificate</a>.</p>
<p>By default, "acme-mailcow" will create a single SAN certificate for all validated domains
(see the <a href="#lets-encrypt-out-of-the-box">first section</a> and <a href="#additional-domain-names">Additional domain names</a>).
This provides best compatibility but means the Let's Encrypt limit exceeds if you add too many domains to a single mailcow installation.</p>
<p>To solve this, you can configure <code>ENABLE_SSL_SNI</code> to generate:</p>
<ul>
<li>A main server certificate with <code>MAILCOW_HOSTNAME</code> and all fully qualified domain names in the <code>ADDITIONAL_SAN</code> config</li>
<li>One additional certificate for each domain found in the database with autodiscover.<em>, autoconfig.</em> and any other <code>ADDITIONAL_SAN</code> configured in this format (subdomain.*).</li>
<li>Limitations: A certificate name <code>ADDITIONAL_SAN=test.example.com</code> will be added as SAN to the main certificate. A separate certificate/key pair will <strong>not</strong> be generated for this format.</li>
</ul>
<p>Postfix, Dovecot and Nginx will then serve these certificates with SNI.</p>
<p>Set <code>ENABLE_SSL_SNI=y</code> in "mailcow.conf" and recreate "acme-mailcow" by running <code>docker-compose up -d</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not all clients support SNI, <a href="https://wiki.dovecot.org/SSL/SNIClientSupport">see Dovecot documentation</a> or <a href="https://en.wikipedia.org/wiki/Server_Name_Indication#Support">Wikipedia</a>.
You should make sure these clients use the <code>MAILCOW_HOSTNAME</code> for secure connections if you enable this feature.</p>
</div>
<p>Here is an example:</p>
<ul>
<li><code>MAILCOW_HOSTNAME=server.email.tld</code></li>
<li><code>ADDITIONAL_SAN=webmail.email.tld,mail.*</code></li>
<li>Mailcow email domains: "domain1.tld" and "domain2.tld"</li>
</ul>
<p>The following certificates will be generated:</p>
<ul>
<li><code>server.email.tld, webmail.email.tld</code> -&gt; this is the default certificate, all clients can connect with these domains</li>
<li><code>mail.domain1.tld, autoconfig.domain1.tld, autodiscover.domain1.tld</code> -&gt; individual certificate for domain1.tld, cannot be used by clients without SNI support</li>
<li><code>mail.domain2.tld, autoconfig.domain2.tld, autodiscover.domain2.tld</code> -&gt; individual certificate for domain2.tld, cannot be used by clients without SNI support</li>
</ul>
<h3 id="how-to-use-your-own-certificate">How to use your own certificate<a class="headerlink" href="#how-to-use-your-own-certificate" title="Permanent link">&para;</a></h3>
<p>Make sure you disable mailcows internal LE client (see above).</p>
<p>To use your own certificates, just save the combined certificate (containing the certificate and intermediate CA/CA if any) to <code>data/assets/ssl/cert.pem</code> and the corresponding key to <code>data/assets/ssl/key.pem</code>.</p>
<p><strong>IMPORTANT:</strong> Do not use symbolic links! Make sure you copy the certificates and do not link them to <code>data/assets/ssl</code>.</p>
<p>Restart affected services afterwards:</p>
<div class="highlight"><pre><span></span><code>docker restart $(docker ps -qaf name=postfix-mailcow)
docker restart $(docker ps -qaf name=nginx-mailcow)
docker restart $(docker ps -qaf name=dovecot-mailcow)
</code></pre></div>
<p>See <a href="../firststeps-rp/#optional-post-hook-script-for-non-mailcow-acme-clients">Post-hook script for non-mailcow ACME clients</a> for a full example script.</p>
<h3 id="test-against-staging-acme-directory">Test against staging ACME directory<a class="headerlink" href="#test-against-staging-acme-directory" title="Permanent link">&para;</a></h3>
<p>Edit <code>mailcow.conf</code> and add <code>LE_STAGING=y</code>.</p>
<p>Run <code>docker-compose up -d</code> to activate your changes.</p>
<h3 id="custom-directory-url">Custom directory URL<a class="headerlink" href="#custom-directory-url" title="Permanent link">&para;</a></h3>
<p>Edit <code>mailcow.conf</code> and add the corresponding directory URL to the new variable <code>DIRECTORY_URL</code>:</p>
<div class="highlight"><pre><span></span><code>DIRECTORY_URL=https://acme-custom-v9000.api.letsencrypt.org/directory
</code></pre></div>
<p>You cannot use <code>LE_STAGING</code> with <code>DIRECTORY_URL</code>. If both are set, only <code>LE_STAGING</code> is used.</p>
<p>Run <code>docker-compose up -d</code> to activate your changes.</p>
<h3 id="check-your-configuration">Check your configuration<a class="headerlink" href="#check-your-configuration" title="Permanent link">&para;</a></h3>
<p>Run <code>docker-compose logs acme-mailcow</code> to find out why a validation fails.</p>
<p>To check if nginx serves the correct certificate, simply use a browser of your choice and check the displayed certificate.</p>
<p>To check the certificate served by Postfix, Dovecot and Nginx we will use <code>openssl</code>:</p>
<div class="highlight"><pre><span></span><code># Connect via SMTP (587)
echo &quot;Q&quot; | openssl s_client -starttls smtp -crlf -connect mx.mailcow.email:587
# Connect via IMAP (143)
echo &quot;Q&quot; | openssl s_client -starttls imap -showcerts -connect mx.mailcow.email:143
# Connect via HTTPS (443)
echo &quot;Q&quot; | openssl s_client -connect mx.mailcow.email:443
</code></pre></div>
<p>To validate the expiry dates as returned by openssl against MAILCOW_HOSTNAME, you are able to use our helper script:</p>
<div class="highlight"><pre><span></span><code>cd /opt/mailcow-dockerized
bash helper-scripts/expiry-dates.sh
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../i_u_m_deinstall/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deinstallation
            </div>
          </div>
        </a>
      
      
        <a href="../firststeps-disable_ipv6/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Disable IPv6
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 André Peters
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://mailcow.email" target="_blank" rel="noopener" title="mailcow.email" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm82.29 357.6c-3.9 3.88-7.99 7.95-11.31 11.28-2.99 3-5.1 6.7-6.17 10.71-1.51 5.66-2.73 11.38-4.77 16.87l-17.39 46.85c-13.76 3-28 4.69-42.65 4.69v-27.38c1.69-12.62-7.64-36.26-22.63-51.25-6-6-9.37-14.14-9.37-22.63v-32.01c0-11.64-6.27-22.34-16.46-27.97-14.37-7.95-34.81-19.06-48.81-26.11-11.48-5.78-22.1-13.14-31.65-21.75l-.8-.72a114.792 114.792 0 0 1-18.06-20.74c-9.38-13.77-24.66-36.42-34.59-51.14 20.47-45.5 57.36-82.04 103.2-101.89l24.01 12.01C203.48 89.74 216 82.01 216 70.11v-11.3c7.99-1.29 16.12-2.11 24.39-2.42l28.3 28.3c6.25 6.25 6.25 16.38 0 22.63L264 112l-10.34 10.34c-3.12 3.12-3.12 8.19 0 11.31l4.69 4.69c3.12 3.12 3.12 8.19 0 11.31l-8 8a8.008 8.008 0 0 1-5.66 2.34h-8.99c-2.08 0-4.08.81-5.58 2.27l-9.92 9.65a8.008 8.008 0 0 0-1.58 9.31l15.59 31.19c2.66 5.32-1.21 11.58-7.15 11.58h-5.64c-1.93 0-3.79-.7-5.24-1.96l-9.28-8.06a16.017 16.017 0 0 0-15.55-3.1l-31.17 10.39a11.95 11.95 0 0 0-8.17 11.34c0 4.53 2.56 8.66 6.61 10.69l11.08 5.54c9.41 4.71 19.79 7.16 30.31 7.16s22.59 27.29 32 32h66.75c8.49 0 16.62 3.37 22.63 9.37l13.69 13.69a30.503 30.503 0 0 1 8.93 21.57 46.536 46.536 0 0 1-13.72 32.98zM417 274.25c-5.79-1.45-10.84-5-14.15-9.97l-17.98-26.97a23.97 23.97 0 0 1 0-26.62l19.59-29.38c2.32-3.47 5.5-6.29 9.24-8.15l12.98-6.49C440.2 193.59 448 223.87 448 256c0 8.67-.74 17.16-1.82 25.54L417 274.25z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/mailcow" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
        <script src="../clients.js"></script>
      
    
  </body>
</html>